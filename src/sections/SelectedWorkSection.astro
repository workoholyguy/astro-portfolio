---
import { getCollection } from 'astro:content';
import Container from '@/components/ui/Container.astro';
import Section from '@/components/ui/Section.astro';
import GlassCard from '@/components/ui/GlassCard.astro';
import GradientText from '@/components/ui/GradientText.astro';
import Button from '@/components/ui/Button.astro';
import Badge from '@/components/ui/Badge.astro';
import RevealOnScroll from '@/components/motion/RevealOnScroll.astro';

// Get featured projects
const allProjects = await getCollection('projects');
const projects = allProjects
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 6);
---

<Section id="work" padding="lg" background="default">
  <Container size="xl">
    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-12">
      <div class="max-w-2xl">
        <RevealOnScroll>
          <p class="text-accent-primary text-sm font-medium tracking-wide uppercase mb-4">
            Selected Work
          </p>
        </RevealOnScroll>
        <RevealOnScroll delay={100}>
          <h2 class="text-display-lg md:text-display-xl text-text">
            Projects we're
            <GradientText>proud of</GradientText>
          </h2>
        </RevealOnScroll>
      </div>
      <RevealOnScroll delay={200}>
        <Button href="/work" variant="secondary">
          View All Projects
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </Button>
      </RevealOnScroll>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {projects.map((project, index) => (
        <RevealOnScroll delay={index * 100}>
          <a href={`/work/${project.data.slug}`} class="group block">
            <GlassCard hover={true} padding="none" class="overflow-hidden">
              <!-- Project Image -->
              <div class="aspect-video relative overflow-hidden bg-surface-200">
                <img
                  src={project.data.thumbnail || project.data.image.src}
                  alt={project.data.image.alt}
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-surface via-transparent to-transparent opacity-60"></div>
              </div>

              <!-- Project Info -->
              <div class="p-6">
                <div class="flex flex-wrap gap-2 mb-3">
                  {project.data.tags.slice(0, 2).map((tag) => (
                    <Badge variant="outline" size="sm">{tag}</Badge>
                  ))}
                </div>
                <h3 class="text-lg font-semibold text-text mb-2 group-hover:text-accent-primary transition-colors">
                  {project.data.name}
                </h3>
                <p class="text-text-muted text-sm line-clamp-2">
                  {project.data.shortDescription}
                </p>
              </div>
            </GlassCard>
          </a>
        </RevealOnScroll>
      ))}
    </div>
  </Container>
</Section>
